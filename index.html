<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oso Abrazos con Kaboom.js</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5);
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 20px;
            max-width: 800px;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 500px;
            border: 5px solid #FFD700;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
            background: #87CEEB;
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        #start-button {
            background: linear-gradient(to bottom, #FFD700, #FF9800);
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            color: #8B4513;
            font-weight: bold;
            cursor: pointer;
            margin: 20px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        #start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .game-ui {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            text-align: left;
            font-size: 16px;
            z-index: 10;
        }
        
        .power-bar {
            width: 100px;
            height: 12px;
            background: #444;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .power-level {
            height: 100%;
            background: linear-gradient(to right, #FF69B4, #FF1493);
            width: 100%;
            border-radius: 6px;
            transition: width 0.3s;
        }
        
        .controls {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            max-width: 800px;
        }
        
        .controls h3 {
            color: #FFD700;
            margin-top: 0;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            text-align: left;
        }
        
        .mobile-controls {
            display: none;
            margin-top: 20px;
            gap: 10px;
        }
        
        .mobile-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        @media (max-width: 830px) {
            #game-container {
                width: 100%;
                height: 400px;
            }
            
            .mobile-controls {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <h1>üêª Oso Abrazos con Kaboom.js</h1>
    <p class="subtitle">¬°Ayuda al Oso Abrazos a recolectar miel y abrazar a todos sus amigos!</p>
    
    <div id="game-container">
        <div id="start-screen">
            <h2>¬°Bienvenido a Oso Abrazos!</h2>
            <p>Presiona el bot√≥n para comenzar la aventura</p>
            <button id="start-button">üéÆ Comenzar Juego</button>
        </div>
        
        <div class="game-ui">
            <div>Puntos: <span id="score">0</span></div>
            <div>Vidas: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
            <div>Nivel: <span id="level">1-1</span></div>
            <div id="unicornPower" style="display: none;">
                <span>ü¶Ñ Poder del Unicornio:</span>
                <div class="power-bar">
                    <div class="power-level" id="unicornPowerLevel"></div>
                </div>
            </div>
            <div id="heartsCollected" style="display: none;">
                <span>üíï Corazones: <span id="heartCount">0</span>/3</span>
            </div>
        </div>
    </div>
    
    <div class="controls">
        <h3>Controles:</h3>
        <div class="controls-grid">
            <div>‚¨ÖÔ∏è ‚û°Ô∏è : Moverse izquierda/derecha</div>
            <div>‚¨ÜÔ∏è : Saltar</div>
            <div>ESPACIO : Abrazar</div>
            <div>Z : Disparar (con unicornio)</div>
        </div>
    </div>
    
    <div class="mobile-controls">
        <button class="mobile-btn" id="leftBtn">‚¨Ö</button>
        <button class="mobile-btn" id="upBtn">‚¨Ü</button>
        <button class="mobile-btn" id="rightBtn">‚û°</button>
        <button class="mobile-btn" id="actionBtn">ü§ó</button>
    </div>

    <!-- Cargar Kaboom.js desde CDN -->
    <script src="https://kaboomjs.com/lib/0.6.0/kaboom.js"></script>
    
    <script>
        // Variables globales del juego
        let gameScore = 0;
        let gameLives = 3;
        let gameHearts = 0;
        let unicornPower = 0;
        let currentLevel = "1-1";
        let unicornActive = false;
        let k; // Variable para la instancia de Kaboom
        
        // URLs base para las im√°genes
        const baseUrl = "https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/main/img";
        
        // Assets del juego - usando placeholders para evitar errores 404
        const gameAssets = {
            "oso": `${baseUrl}/oso/oso_idle.svg`,
            "oso_camina": `${baseUrl}/oso/oso_walk.svg`,
            "oso_salta": `${baseUrl}/oso/oso_jump.svg`,
            "oso_abrazando": `${baseUrl}/oso/oso_hugging.svg`,
            "oso_unicornio": `${baseUrl}/Amigos/osoyuni.png`,
            "ardilla": `${baseUrl}/Amigos/ardilla.png`,
            "conejo": `${baseUrl}/Amigos/conejo.png`,
            "pajaro": `${baseUrl}/Amigos/pajarito.png`,
            "enemigo1": `${baseUrl}/enemigos/Enemigos-01.svg`,
            "enemigo2": `${baseUrl}/enemigos/Enemigos-02.svg`,
            "enemigo3": `${baseUrl}/enemigos/Enemigos-03.svg`,
            "corazon": `${baseUrl}/Amigos/lovepower.png`,
            "miel": `${baseUrl}/Amigos/miel.png`,
            "fondo1": "https://placehold.co/800x500/87CEEB/FFFFFF?text=Bosque+Encantado",
            "fondo2": "https://placehold.co/800x500/4682B4/FFFFFF?text=Claro+Soleado",
            "fondo3": "https://placehold.co/800x500/2F4F4F/FFFFFF?text=Cueva+Misteriosa",
            "lobo": `${baseUrl}/enemigos/loboferoz.png`,
            "fuego": `${baseUrl}/enemigos/fire.png`
        };
        
        // Inicializar el juego despu√©s de la interacci√≥n del usuario
        document.getElementById("start-button").addEventListener("click", initGame);
        
        function initGame() {
            // Ocultar pantalla de inicio
            document.getElementById("start-screen").style.display = "none";
            
            // Inicializar Kaboom despu√©s de la interacci√≥n del usuario
            k = kaboom({
                width: 800,
                height: 500,
                background: [135, 206, 235],
                global: false
            });
            
            // Cargar assets del juego
            loadAssets();
        }
        
        function loadAssets() {
            // Cargar todos los assets
            for (const [name, url] of Object.entries(gameAssets)) {
                k.loadSprite(name, url, {
                    error: () => {
                        console.log(`Usando placeholder para: ${name}`);
                        // Si hay error, usar un placeholder
                        k.loadSprite(name, `https://placehold.co/100x100/333333/FFFFFF?text=${encodeURIComponent(name)}`);
                    }
                });
            }
            
            // Sonidos de placeholder
            k.loadSound("salto", "https://kaboomjs.com/sfx/jump.mp3");
            k.loadSound("colectar", "https://kaboomjs.com/sfx/score.mp3");
            k.loadSound("golpe", "https://kaboomjs.com/sfx/hurt.mp3");
            
            // Iniciar el juego cuando todos los assets est√©n cargados
            k.onLoad(() => {
                console.log("Todos los assets cargados");
                startGame();
            });
        }
        
        // Definir las escenas
        function startGame() {
            k.scene("nivel-1", () => setupNivel("1-1"));
            k.scene("nivel-2", () => setupNivel("1-2"));
            k.scene("nivel-3", () => setupNivel("1-3"));
            k.scene("nivel-jefe", () => setupNivelJefe());
            
            k.go("nivel-1");
        }
        
        function setupNivel(nivel) {
            currentLevel = nivel;
            document.getElementById("level").textContent = nivel;
            
            // Configurar el nivel
            k.add([
                k.sprite(`fondo${nivel.split("-")[1]}`),
                k.pos(0, 0),
                k.fixed(),
                k.scale(2.5)
            ]);
            
            // Plataformas
            k.add([
                k.rect(800, 50),
                k.pos(0, 450),
                k.area(),
                k.solid(),
                k.color(139, 69, 19),
                "plataforma"
            ]);
            
            k.add([
                k.rect(100, 20),
                k.pos(200, 350),
                k.area(),
                k.solid(),
                k.color(139, 69, 19),
                "plataforma"
            ]);
            
            k.add([
                k.rect(100, 20),
                k.pos(400, 300),
                k.area(),
                k.solid(),
                k.color(139, 69, 19),
                "plataforma"
            ]);
            
            k.add([
                k.rect(100, 20),
                k.pos(600, 350),
                k.area(),
                k.solid(),
                k.color(139, 69, 19),
                "plataforma"
            ]);
            
            // Crear oso
            const oso = k.add([
                k.sprite("oso"),
                k.pos(100, 380),
                k.area(),
                k.body(),
                k.health(3),
                "jugador",
                {
                    velocidad: 200,
                    fuerzaSalto: 400,
                    direccion: 1,
                    abrazando: false
                }
            ]);
            
            // Crear amigos
            crearAmigo("ardilla", 300, 380);
            crearAmigo("conejo", 500, 380);
            crearAmigo("pajaro", 700, 380);
            
            // Crear enemigos (en el lado derecho)
            crearEnemigo("enemigo1", 600, 380);
            crearEnemigo("enemigo2", 700, 380);
            
            // Crear corazones
            crearCorazon(200, 300);
            crearCorazon(400, 250);
            crearCorazon(600, 300);
            
            // Crear miel
            crearMiel(250, 200);
            crearMiel(550, 180);
            
            // Controles
            k.onKeyDown("left", () => {
                if (!oso.abrazando) {
                    oso.move(-oso.velocidad, 0);
                    oso.direccion = -1;
                    oso.flipX = true;
                }
            });
            
            k.onKeyDown("right", () => {
                if (!oso.abrazando) {
                    oso.move(oso.velocidad, 0);
                    oso.direccion = 1;
                    oso.flipX = false;
                }
            });
            
            k.onKeyPress("up", () => {
                if (oso.isGrounded() && !oso.abrazando) {
                    oso.jump(oso.fuerzaSalto);
                    k.play("salto");
                }
            });
            
            k.onKeyPress("space", () => {
                abrazar(oso);
            });
            
            k.onKeyPress("z", () => {
                if (unicornActive && unicornPower > 0) {
                    dispararUnicornio(oso);
                }
            });
            
            // Controles m√≥viles
            document.getElementById("leftBtn").addEventListener("mousedown", () => {
                if (!oso.abrazando) {
                    oso.move(-oso.velocidad, 0);
                    oso.direccion = -1;
                    oso.flipX = true;
                }
            });
            
            document.getElementById("rightBtn").addEventListener("mousedown", () => {
                if (!oso.abrazando) {
                    oso.move(oso.velocidad, 0);
                    oso.direccion = 1;
                    oso.flipX = false;
                }
            });
            
            document.getElementById("upBtn").addEventListener("mousedown", () => {
                if (oso.isGrounded() && !oso.abrazando) {
                    oso.jump(oso.fuerzaSalto);
                    k.play("salto");
                }
            });
            
            document.getElementById("actionBtn").addEventListener("mousedown", () => {
                abrazar(oso);
            });
            
            // Actualizar UI
            k.onUpdate(() => {
                if (unicornActive) {
                    document.getElementById("unicornPower").style.display = "block";
                    document.getElementById("unicornPowerLevel").style.width = `${unicornPower}%`;
                    
                    // Regenerar poder lentamente
                    if (unicornPower < 100) {
                        unicornPower += 0.2;
                    }
                }
            });
        }
        
        function crearAmigo(tipo, x, y) {
            const amigo = k.add([
                k.sprite(tipo),
                k.pos(x, y),
                k.area(),
                k.body({ isStatic: true }),
                "amigo",
                { abrazado: false }
            ]);
            
            // Animaci√≥n de flotar
            let floatDir = 1;
            amigo.onUpdate(() => {
                if (!amigo.abrazado) {
                    amigo.pos.y += Math.sin(k.time() * 2) * 0.5 * floatDir;
                }
            });
            
            return amigo;
        }
        
        function crearEnemigo(tipo, x, y) {
            const enemigo = k.add([
                k.sprite(tipo),
                k.pos(x, y),
                k.area(),
                k.body(),
                "enemigo",
                {
                    direccion: -1,
                    velocidad: 50,
                    rango: 100,
                    posInicial: x
                }
            ]);
            
            // Movimiento de lado a lado
            enemigo.onUpdate(() => {
                enemigo.move(enemigo.velocidad * enemigo.direccion, 0);
                
                if (Math.abs(enemigo.pos.x - enemigo.posInicial) > enemigo.rango) {
                    enemigo.direccion *= -1;
                    enemigo.flipX = !enemigo.flipX;
                }
            });
            
            return enemigo;
        }
        
        function crearCorazon(x, y) {
            return k.add([
                k.sprite("corazon"),
                k.pos(x, y),
                k.area(),
                k.body({ isStatic: true }),
                "corazon"
            ]);
        }
        
        function crearMiel(x, y) {
            return k.add([
                k.sprite("miel"),
                k.pos(x, y),
                k.area(),
                k.body({ isStatic: true }),
                "miel"
            ]);
        }
        
        function abrazar(oso) {
            if (oso.abrazando) return;
            
            oso.abrazando = true;
            oso.use(k.sprite("oso_abrazando"));
            
            // Verificar si est√° abrazando a un amigo
            const amigos = k.get("amigo");
            for (const amigo of amigos) {
                if (oso.pos.dist(amigo.pos) < 80 && !amigo.abrazado) {
                    amigo.abrazado = true;
                    amigo.hidden = true;
                    gameScore += 100;
                    document.getElementById("score").textContent = gameScore;
                    k.play("colectar");
                    
                    // Efecto de part√≠culas
                    for (let i = 0; i < 10; i++) {
                        k.add([
                            k.pos(amigo.pos),
                            k.color(255, 215, 0),
                            k.opacity(1),
                            k.rotate(0),
                            k.scale(1),
                            k.lifespan(1),
                            k.move(k.rand(-100, 100), k.rand(-100, 100)),
                            k.circle(3)
                        ]);
                    }
                }
            }
            
            // Volver a la normalidad despu√©s de un tiempo
            k.wait(0.5, () => {
                oso.abrazando = false;
                oso.use(k.sprite("oso"));
            });
        }
        
        function dispararUnicornio(oso) {
            if (unicornPower < 10) return;
            
            unicornPower -= 10;
            
            k.add([
                k.pos(oso.pos.x + (oso.direccion * 30), oso.pos.y),
                k.area(),
                k.color(255, 105, 180),
                k.move(oso.direccion * 300, 0),
                k.circle(8),
                "proyectil-unicornio",
                k.lifespan(2)
            ]);
            
            k.play("colectar");
        }
        
        function setupNivelJefe() {
            // Implementaremos la escena del jefe despu√©s
            k.go("nivel-1");
        }
        
        // Colisiones
        k.onCollide("jugador", "enemigo", (jugador, enemigo) => {
            if (jugador.abrazando) {
                // Si est√° abrazando, derrotar al enemigo
                enemigo.destroy();
                gameScore += 200;
                document.getElementById("score").textContent = gameScore;
                
                // Efecto de part√≠culas
                for (let i = 0; i < 15; i++) {
                    k.add([
                        k.pos(enemigo.pos),
                        k.color(255, 0, 0),
                        k.opacity(1),
                        k.rotate(0),
                        k.scale(1),
                        k.lifespan(1),
                        k.move(k.rand(-150, 150), k.rand(-150, 150)),
                        k.circle(4)
                    ]);
                }
            } else {
                // Si no est√° abrazando, recibir da√±o
                jugador.hurt(1);
                gameLives--;
                document.getElementById("lives").textContent = "‚ù§Ô∏è".repeat(gameLives);
                k.play("golpe");
                
                if (gameLives <= 0) {
                    k.go("nivel-1");
                    gameLives = 3;
                    gameScore = 0;
                    document.getElementById("lives").textContent = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è";
                    document.getElementById("score").textContent = "0";
                }
            }
        });
        
        k.onCollide("jugador", "corazon", (jugador, corazon) => {
            corazon.destroy();
            gameHearts++;
            document.getElementById("heartCount").textContent = gameHearts;
            gameScore += 50;
            document.getElementById("score").textContent = gameScore;
            k.play("colectar");
            
            if (gameHearts >= 3 && !unicornActive) {
                unicornActive = true;
                gameHearts = 0;
                document.getElementById("heartsCollected").style.display = "block";
                jugador.use(k.sprite("oso_unicornio"));
            }
        });
        
        k.onCollide("jugador", "miel", (jugador, miel) => {
            miel.destroy();
            gameScore += 30;
            document.getElementById("score").textContent = gameScore;
            k.play("colectar");
        });
        
        k.onCollide("proyectil-unicornio", "enemigo", (proyectil, enemigo) => {
            proyectil.destroy();
            enemigo.destroy();
            gameScore += 50;
            document.getElementById("score").textContent = gameScore;
            
            // Efecto de part√≠culas
            for (let i = 0; i < 10; i++) {
                k.add([
                    k.pos(enemigo.pos),
                    k.color(148, 0, 211),
                    k.opacity(1),
                    k.rotate(0),
                    k.scale(1),
                    k.lifespan(1),
                    k.move(k.rand(-120, 120), k.rand(-120, 120)),
                    k.circle(5)
                ]);
            }
        });
    </script>
</body>
</html>
