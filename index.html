<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oso Abrazos con Kaboom.js</title>
    <script src="https://kaboomjs.com/lib/0.6.0/kaboom.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }
        
        #game-container {
            position: relative;
            width: 800px;
            height: 500px;
            border: 5px solid #FFD700;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
        }
        
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .loading-bar {
            width: 300px;
            height: 20px;
            background: #555;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .loading-progress {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        
        .game-ui {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            text-align: left;
            font-size: 16px;
            z-index: 10;
        }
        
        .power-bar {
            width: 100px;
            height: 12px;
            background: #444;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .power-level {
            height: 100%;
            background: linear-gradient(to right, #FF69B4, #FF1493);
            width: 100%;
            border-radius: 6px;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="loading-screen">
            <h2>Cargando Oso Abrazos...</h2>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <p id="loading-text">0%</p>
        </div>
        
        <div class="game-ui">
            <div>Puntos: <span id="score">0</span></div>
            <div>Vidas: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
            <div>Nivel: <span id="level">1-1</span></div>
            <div id="unicornPower" style="display: none;">
                <span>ü¶Ñ Poder del Unicornio:</span>
                <div class="power-bar">
                    <div class="power-level" id="unicornPowerLevel"></div>
                </div>
            </div>
            <div id="heartsCollected" style="display: none;">
                <span>üíï Corazones: <span id="heartCount">0</span>/3</span>
            </div>
        </div>
    </div>

    <script>
        // URLs base para las im√°genes
        const baseUrl = "https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/main/img";
        
        // Inicializar Kaboom
        const k = kaboom({
            width: 800,
            height: 500,
            canvas: document.querySelector("#game-container"),
            background: [135, 206, 235],
            global: false
        });
        
        // Variables del juego
        let gameScore = 0;
        let gameLives = 3;
        let gameHearts = 0;
        let unicornPower = 0;
        let currentLevel = "1-1";
        let unicornActive = false;
        
        // Assets del juego
        const gameAssets = {
            "oso": `${baseUrl}/oso/oso_idle.svg`,
            "oso_camina": `${baseUrl}/oso/oso_walk.svg`,
            "oso_salta": `${baseUrl}/oso/oso_jump.svg`,
            "oso_abrazando": `${baseUrl}/oso/oso_hugging.svg`,
            "oso_unicornio": `${baseUrl}/Amigos/osoyuni.png`,
            "ardilla": `${baseUrl}/Amigos/ardilla.png`,
            "conejo": `${baseUrl}/Amigos/conejo.png`,
            "pajaro": `${baseUrl}/Amigos/pajarito.png`,
            "enemigo1": `${baseUrl}/enemigos/Enemigos-01.svg`,
            "enemigo2": `${baseUrl}/enemigos/Enemigos-02.svg`,
            "enemigo3": `${baseUrl}/enemigos/Enemigos-03.svg`,
            "corazon": `${baseUrl}/Amigos/lovepower.png`,
            "miel": `${baseUrl}/Amigos/miel.png`,
            "fondo1": `${baseUrl}/fondos/bosque1.jpg`,
            "fondo2": `${baseUrl}/fondos/bosque2.jpg`,
            "fondo3": `${baseUrl}/fondos/bosque3.jpg`,
            "fondo4": `${baseUrl}/fondos/bosque4.jpg`,
            "lobo": `${baseUrl}/enemigos/loboferoz.png`,
            "fuego": `${baseUrl}/enemigos/fire.png`
        };
        
        // Cargar assets con barra de progreso
        let loadedAssets = 0;
        const totalAssets = Object.keys(gameAssets).length;
        
        function updateProgress() {
            loadedAssets++;
            const progress = Math.floor((loadedAssets / totalAssets) * 100);
            document.getElementById("loading-progress").style.width = `${progress}%`;
            document.getElementById("loading-text").textContent = `${progress}%`;
            
            if (loadedAssets === totalAssets) {
                setTimeout(() => {
                    document.querySelector(".loading-screen").style.display = "none";
                    startGame();
                }, 500);
            }
        }
        
        // Cargar todos los assets
        for (const [name, url] of Object.entries(gameAssets)) {
            k.loadSprite(name, url, {
                error: () => {
                    console.error(`Error cargando: ${name}`);
                    updateProgress();
                },
                success: () => {
                    console.log(`Cargado: ${name}`);
                    updateProgress();
                }
            });
        }
        
        // Sonidos (los agregaremos despu√©s)
        k.loadRoot("https://cdn.pixabay.com/download/audio/");
        k.loadSound("salto", "2022/03/15/audio_5c4dc48e9c.mp3?filename=jump-6460.mp3");
        k.loadSound("colectar", "2022/03/19/audio_5c452fd8e9.mp3?filename=power-up-6768.mp3");
        
        // Definir las escenas
        function startGame() {
            k.scene("nivel-1", () => setupNivel("1-1"));
            k.scene("nivel-2", () => setupNivel("1-2"));
            k.scene("nivel-3", () => setupNivel("1-3"));
            k.scene("nivel-jefe", () => setupNivelJefe());
            
            k.go("nivel-1");
        }
        
        function setupNivel(nivel) {
            currentLevel = nivel;
            document.getElementById("level").textContent = nivel;
            
            // Configurar el nivel
            k.add([
                k.sprite(`fondo${nivel.split("-")[1]}`),
                k.pos(0, 0),
                k.fixed(),
                k.scale(2.5)
            ]);
            
            // Plataformas
            k.add([
                k.rect(800, 50),
                k.pos(0, 450),
                k.area(),
                k.solid(),
                k.color(139, 69, 19),
                "plataforma"
            ]);
            
            k.add([
                k.rect(100, 20),
                k.pos(200, 350),
                k.area(),
                k.solid(),
                k.color(139, 69, 19),
                "plataforma"
            ]);
            
            k.add([
                k.rect(100, 20),
                k.pos(400, 300),
                k.area(),
                k.solid(),
                k.color(139, 69, 19),
                "plataforma"
            ]);
            
            k.add([
                k.rect(100, 20),
                k.pos(600, 350),
                k.area(),
                k.solid(),
                k.color(139, 69, 19),
                "plataforma"
            ]);
            
            // Crear oso
            const oso = k.add([
                k.sprite("oso"),
                k.pos(100, 380),
                k.area(),
                k.body(),
                k.health(3),
                "jugador",
                {
                    velocidad: 200,
                    fuerzaSalto: 400,
                    direccion: 1,
                    abrazando: false
                }
            ]);
            
            // Crear amigos
            crearAmigo("ardilla", 300, 380);
            crearAmigo("conejo", 500, 380);
            crearAmigo("pajaro", 700, 380);
            
            // Crear enemigos (en el lado derecho)
            crearEnemigo("enemigo1", 600, 380);
            crearEnemigo("enemigo2", 700, 380);
            
            // Crear corazones
            crearCorazon(200, 300);
            crearCorazon(400, 250);
            crearCorazon(600, 300);
            
            // Crear miel
            crearMiel(250, 200);
            crearMiel(550, 180);
            
            // Controles
            k.onKeyDown("left", () => {
                if (!oso.abrazando) {
                    oso.move(-oso.velocidad, 0);
                    oso.direccion = -1;
                    oso.flipX = true;
                }
            });
            
            k.onKeyDown("right", () => {
                if (!oso.abrazando) {
                    oso.move(oso.velocidad, 0);
                    oso.direccion = 1;
                    oso.flipX = false;
                }
            });
            
            k.onKeyPress("up", () => {
                if (oso.isGrounded() && !oso.abrazando) {
                    oso.jump(oso.fuerzaSalto);
                    k.play("salto");
                }
            });
            
            k.onKeyPress("space", () => {
                abrazar(oso);
            });
            
            k.onKeyPress("z", () => {
                if (unicornActive && unicornPower > 0) {
                    dispararUnicornio(oso);
                }
            });
            
            // Actualizar UI
            k.onUpdate(() => {
                if (unicornActive) {
                    document.getElementById("unicornPower").style.display = "block";
                    document.getElementById("unicornPowerLevel").style.width = `${unicornPower}%`;
                    
                    // Regenerar poder lentamente
                    if (unicornPower < 100) {
                        unicornPower += 0.2;
                    }
                }
            });
        }
        
        function crearAmigo(tipo, x, y) {
            const amigo = k.add([
                k.sprite(tipo),
                k.pos(x, y),
                k.area(),
                k.body({ isStatic: true }),
                "amigo",
                { abrazado: false }
            ]);
            
            // Animaci√≥n de flotar
            let floatDir = 1;
            amigo.onUpdate(() => {
                if (!amigo.abrazado) {
                    amigo.pos.y += Math.sin(k.time() * 2) * 0.5 * floatDir;
                }
            });
            
            return amigo;
        }
        
        function crearEnemigo(tipo, x, y) {
            const enemigo = k.add([
                k.sprite(tipo),
                k.pos(x, y),
                k.area(),
                k.body(),
                "enemigo",
                {
                    direccion: -1,
                    velocidad: 50,
                    rango: 100,
                    posInicial: x
                }
            ]);
            
            // Movimiento de lado a lado
            enemigo.onUpdate(() => {
                enemigo.move(enemigo.velocidad * enemigo.direccion, 0);
                
                if (Math.abs(enemigo.pos.x - enemigo.posInicial) > enemigo.rango) {
                    enemigo.direccion *= -1;
                    enemigo.flipX = !enemigo.flipX;
                }
            });
            
            return enemigo;
        }
        
        function crearCorazon(x, y) {
            return k.add([
                k.sprite("corazon"),
                k.pos(x, y),
                k.area(),
                k.body({ isStatic: true }),
                "corazon"
            ]);
        }
        
        function crearMiel(x, y) {
            return k.add([
                k.sprite("miel"),
                k.pos(x, y),
                k.area(),
                k.body({ isStatic: true }),
                "miel"
            ]);
        }
        
        function abrazar(oso) {
            if (oso.abrazando) return;
            
            oso.abrazando = true;
            oso.use(k.sprite("oso_abrazando"));
            
            // Verificar si est√° abrazando a un amigo
            const amigos = k.get("amigo");
            for (const amigo of amigos) {
                if (oso.pos.dist(amigo.pos) < 80 && !amigo.abrazado) {
                    amigo.abrazado = true;
                    amigo.hidden = true;
                    gameScore += 100;
                    document.getElementById("score").textContent = gameScore;
                    k.play("colectar");
                    
                    // Efecto de part√≠culas
                    for (let i = 0; i < 10; i++) {
                        k.add([
                            k.pos(amigo.pos),
                            k.color(255, 215, 0),
                            k.opacity(1),
                            k.rotate(0),
                            k.scale(1),
                            k.lifespan(1),
                            k.move(k.rand(-100, 100), k.rand(-100, 100)),
                            k.circle(3)
                        ]);
                    }
                }
            }
            
            // Volver a la normalidad despu√©s de un tiempo
            k.wait(0.5, () => {
                oso.abrazando = false;
                oso.use(k.sprite("oso"));
            });
        }
        
        function dispararUnicornio(oso) {
            if (unicornPower < 10) return;
            
            unicornPower -= 10;
            
            k.add([
                k.pos(oso.pos.x + (oso.direccion * 30), oso.pos.y),
                k.area(),
                k.color(255, 105, 180),
                k.move(oso.direccion * 300, 0),
                k.circle(8),
                "proyectil-unicornio",
                k.lifespan(2)
            ]);
            
            k.play("colectar");
        }
        
        function setupNivelJefe() {
            // Implementaremos la escena del jefe despu√©s
            k.go("nivel-1");
        }
        
        // Colisiones
        k.onCollide("jugador", "enemigo", (jugador, enemigo) => {
            if (jugador.abrazando) {
                // Si est√° abrazando, derrotar al enemigo
                enemigo.destroy();
                gameScore += 200;
                document.getElementById("score").textContent = gameScore;
                
                // Efecto de part√≠culas
                for (let i = 0; i < 15; i++) {
                    k.add([
                        k.pos(enemigo.pos),
                        k.color(255, 0, 0),
                        k.opacity(1),
                        k.rotate(0),
                        k.scale(1),
                        k.lifespan(1),
                        k.move(k.rand(-150, 150), k.rand(-150, 150)),
                        k.circle(4)
                    ]);
                }
            } else {
                // Si no est√° abrazando, recibir da√±o
                jugador.hurt(1);
                gameLives--;
                document.getElementById("lives").textContent = "‚ù§Ô∏è".repeat(gameLives);
                
                if (gameLives <= 0) {
                    k.go("nivel-1");
                    gameLives = 3;
                    gameScore = 0;
                    document.getElementById("lives").textContent = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è";
                    document.getElementById("score").textContent = "0";
                }
            }
        });
        
        k.onCollide("jugador", "corazon", (jugador, corazon) => {
            corazon.destroy();
            gameHearts++;
            document.getElementById("heartCount").textContent = gameHearts;
            gameScore += 50;
            document.getElementById("score").textContent = gameScore;
            k.play("colectar");
            
            if (gameHearts >= 3 && !unicornActive) {
                unicornActive = true;
                gameHearts = 0;
                document.getElementById("heartsCollected").style.display = "block";
                jugador.use(k.sprite("oso_unicornio"));
            }
        });
        
        k.onCollide("jugador", "miel", (jugador, miel) => {
            miel.destroy();
            gameScore += 30;
            document.getElementById("score").textContent = gameScore;
            k.play("colectar");
        });
        
        k.onCollide("proyectil-unicornio", "enemigo", (proyectil, enemigo) => {
            proyectil.destroy();
            enemigo.destroy();
            gameScore += 50;
            document.getElementById("score").textContent = gameScore;
            
            // Efecto de part√≠culas
            for (let i = 0; i < 10; i++) {
                k.add([
                    k.pos(enemigo.pos),
                    k.color(148, 0, 211),
                    k.opacity(1),
                    k.rotate(0),
                    k.scale(1),
                    k.lifespan(1),
                    k.move(k.rand(-120, 120), k.rand(-120, 120)),
                    k.circle(5)
                ]);
            }
        });
        
        // Iniciar el juego cuando todos los assets est√©n cargados
        k.onLoad(() => {
            console.log("Todos los assets cargados");
        });
    </script>
</body>
</html>
