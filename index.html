<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Oso Abrazos - Aventura Completa</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      color: white;
      text-align: center;
      margin: 0;
      padding: 20px;
      overflow-x: hidden;
    }
    
    h1 {
      font-size: 2.5rem;
      text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5);
      color: #FFD700;
    }
    
    .game-wrapper {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    
    #gameContainer {
      position: relative;
      width: 800px;
      height: 500px;
      border: 5px solid #FFD700;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
    }
    
    #gameCanvas {
      background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
      display: block;
    }
    
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      text-align: left;
      font-size: 16px;
    }
    
    .power-bar {
      width: 100px;
      height: 12px;
      background: #444;
      border-radius: 6px;
      overflow: hidden;
      margin-top: 5px;
    }
    
    .power-level {
      height: 100%;
      background: linear-gradient(to right, #FF69B4, #FF1493);
      width: 100%;
      border-radius: 6px;
      transition: width 0.3s;
    }
    
    #levelIndicator {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
    }
    
    #startScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    
    #coverImage {
      width: 300px;
      height: 200px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 30px;
      border: 3px solid #FFD700;
    }
    
    #startButton, .storybook-btn, .celebration-btn {
      background: linear-gradient(to bottom, #FFD700, #FF9800);
      border: none;
      padding: 15px 30px;
      font-size: 1.2rem;
      border-radius: 50px;
      color: #8B4513;
      font-weight: bold;
      cursor: pointer;
      margin: 10px;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    #startButton:hover, .storybook-btn:hover, .celebration-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }
    
    #hint {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      opacity: 0;
      transition: opacity 0.5s;
    }
    
    #soundToggle {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid white;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 5;
    }
    
    .mobile-controls {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: flex;
      gap: 20px;
      opacity: 0.8;
    }
    
    .mobile-controls-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    
    .mobile-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.9);
      font-size: 1.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    
    .mobile-label {
      color: white;
      font-size: 0.8rem;
      text-shadow: 1px 1px 2px black;
    }
    
    #storybook {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 15;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      text-align: center;
    }
    
    .storybook-images {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
    }
    
    .storybook-images img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      border: 2px solid #FFD700;
      border-radius: 10px;
      background: white;
      padding: 5px;
    }
    
    /* üî• Estilos para el jefe */
    .boss-health {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 400px;
      height: 25px;
      background: #333;
      border-radius: 12px;
      overflow: hidden;
      z-index: 5;
      border: 3px solid #fff;
      display: none;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
    }

    .boss-health-bar {
      height: 100%;
      background: linear-gradient(to right, #ff0000, #ff6600, #ffcc00);
      width: 100%;
      transition: width 0.5s;
      position: relative;
    }

    .boss-health-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      z-index: 6;
    }

    /* ‚ö° Animaci√≥n de advertencia de fuego */
    .fire-warning {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 50px;
      background: linear-gradient(to top, rgba(255, 0, 0, 0.3), transparent);
      z-index: 4;
      display: none;
      animation: warningPulse 0.5s infinite;
    }

    @keyframes warningPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.8; }
    }

    /* üíù Animaci√≥n de corazones brillantes */
    @keyframes heartGlow {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.1); filter: brightness(1.3); }
    }

    .heart-collectible {
      animation: heartGlow 1s infinite;
    }

    /* üéÜ Animaci√≥n de victoria mejorada */
    .victory-animation {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255, 215, 0, 0.4), rgba(255, 140, 0, 0.2));
      z-index: 30;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      text-align: center;
    }

    .victory-title {
      font-size: 4rem;
      margin-bottom: 20px;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
      color: #FFD700;
      animation: victoryBounce 1s ease-in-out infinite alternate;
    }

    @keyframes victoryBounce {
      0% { transform: scale(1); }
      100% { transform: scale(1.05); }
    }

    /* üê∫ Animaci√≥n de enfado del lobo */
    .boss-enraged {
      animation: enrageShake 0.3s infinite;
    }

    @keyframes enrageShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px) rotate(-2deg); }
      75% { transform: translateX(5px) rotate(2deg); }
    }
  </style>
</head>
<body>
  <h1>üêª Oso Abrazos - Aventura Completa</h1>
  <p>¬°Ayuda al Oso Abrazos a derrotar al Lobo Feroz en 6 niveles emocionantes!</p>
  
  <div class="game-wrapper">
    <div id="gameContainer">
      <canvas id="gameCanvas" width="800" height="500"></canvas>

      <!-- UI Mejorada -->
      <div id="ui">
        <div>Puntos: <span id="score">0</span></div>
        <div>Vidas: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
        <div>Nivel: <span id="level">1-1</span></div>
        <div id="unicornPower" style="display: none;">
          <span>ü¶Ñ Poder del Unicornio:</span>
          <div class="power-bar">
              <div class="power-level" id="unicornPowerLevel"></div>
          </div>
        </div>
        <div id="heartsCollected" style="display: none;">
          <span>üíï Corazones: <span id="heartCount">0</span>/3</span>
        </div>
      </div>

      <!-- üê∫ Barra de salud del jefe -->
      <div id="bossHealth" class="boss-health">
        <div class="boss-health-bar" id="bossHealthBar">
          <div class="boss-health-text">üê∫ Lobo Feroz - Vida: <span id="bossHealthText">5/5</span></div>
        </div>
      </div>

      <!-- ‚ö° Advertencia de fuego -->
      <div id="fireWarning" class="fire-warning">
        <div style="text-align: center; color: white; font-weight: bold; padding-top: 10px;">
          ‚ö†Ô∏è ¬°CUIDADO! El lobo va a atacar con fuego ‚ö†Ô∏è
        </div>
      </div>

      <div id="levelIndicator" class="level-indicator">Nivel 1-1</div>

      <!-- Pantalla de inicio con nueva m√∫sica -->
      <div id="startScreen">
        <img id="coverImage" src="https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/refs/heads/main/img/oso/oso_portada.jpg" alt="Oso Abrazos Game Cover">
        <button id="startButton">üéÆ ¬°Comenzar Aventura!</button>
        <audio id="introMusic" loop>
          <source src="https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/refs/heads/main/sounds/intro.mp3" type="audio/mpeg">
        </audio>
        <audio id="battleMusic">
          <source src="https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/refs/heads/main/sounds/para%20la%20batalla.mp3" type="audio/mpeg">
        </audio>
      </div>

      <!-- Pantalla de victoria mejorada -->
      <div id="victoryScreen" class="victory-animation">
        <h2 class="victory-title">üéâ ¬°VICTORIA! üéâ</h2>
        <p style="font-size: 1.5rem; margin-bottom: 20px;">¬°Has derrotado al Lobo Feroz!</p>
        <img src="https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/refs/heads/main/img/oso/celebracion.png" alt="Celebraci√≥n" style="width: 200px; margin: 20px auto;">
        <div style="font-size: 1.2rem; margin-bottom: 30px;">
          <p>Puntuaci√≥n Final: <span id="finalScore">0</span></p>
          <p>Corazones Recolectados: <span id="finalHearts">0</span></p>
        </div>
        <button id="nextLevelBtn" class="celebration-btn">üöÄ ¬°Siguiente Nivel!</button>
      </div>

      <!-- Storybook mejorado -->
      <div id="storybook" style="display: none;">
        <h2>üêª Oso Abrazos vs. üê∫ El Lobo Feroz</h2>
        <p>¬°El malvado Lobo Feroz ha invadido el bosque y quiere acabar con todos los abrazos!</p>
        <p>Debes recolectar <strong>3 corazones m√°gicos</strong> para invocar al Unicornio de la Amistad.</p>
        
        <div class="storybook-images">
          <img src="https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/refs/heads/main/img/enemigos/lobo.svg" alt="Lobo Normal">
          <img src="https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/refs/heads/main/img/enemigos/loboferoz.png" alt="Lobo Enfurecido">
          <img src="https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/refs/heads/main/img/oso/corazon.png" alt="Coraz√≥n">
          <img src="https://raw.githubusercontent.com/Evelez23/-oso.abrazos-/refs/heads/main/img/oso/uniyosocombat.png" alt="Oso y Unicornio">
        </div>
        
        <p>üî• <strong>El lobo tiene 5 puntos de vida</strong> y lanzar√° fuego desde su boca.</p>
        <p>üíï <strong>¬°Recolecta corazones para invocar al unicornio!</strong></p>
        <p>ü¶Ñ <strong>Con el unicornio puedes disparar rayos de amistad</strong> para derrotar al lobo.</p>
        <p>‚ö†Ô∏è <strong>¬°Ten cuidado!</strong> 5 disparos del lobo te derrotar√°n.</p>
        
        <button id="startGame" class="storybook-btn">üí™ ¬°Entendido! ¬°A salvar el bosque!</button>
      </div>

      <div id="hint">Ac√©rcate a los amigos y presiona ESPACIO para abrazarlos</div>
      <button id="soundToggle">üîä</button>

      <!-- Controles m√≥viles -->
      <div class="mobile-controls">
        <div class="mobile-controls-column">
          <button class="mobile-btn" id="leftBtn">‚¨Ö</button>
          <div class="mobile-label">Izquierda</div>
          
          <button class="mobile-btn" id="rightBtn">‚û°</button>
          <div class="mobile-label">Derecha</div>
          
          <button class="mobile-btn" id="jumpBtn">‚¨Ü</button>
          <div class="mobile-label">Saltar</div>
        </div>
        
        <div class="mobile-controls-column">
          <button class="mobile-btn" id="hugBtn">ü§ó</button>
          <div class="mobile-label">Abrazar</div>
          
          <button class="mobile-btn" id="fireBtn">üí´</button>
          <div class="mobile-label">Disparar</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cargar el script del juego -->
  <script src="https://cdn.jsdelivr.net/gh/Evelez23/-oso.abrazos-@main/js/game-complete.js"></script>
  
  <!-- Script de inicializaci√≥n -->
  <script>
    // Esperar a que se cargue la p√°gina
    window.addEventListener('load', function() {
      console.log("üéÆ Inicializando juego Oso Abrazos...");
      
      // Inicializar variables globales si no existen
      window.gameState = window.gameState || {
        gameStarted: false,
        currentLevel: "1-1",
        score: 0,
        lives: 3,
        heartsCollected: 0,
        soundEnabled: true,
        bossFight: false
      };
      
      window.oso = window.oso || {
        x: 100, y: 380,
        width: 80, height: 80,
        vx: 0, vy: 0,
        speed: 5,
        jumpForce: 15,
        gravity: 0.7,
        grounded: false,
        hugging: false,
        hugCooldown: 0,
        direction: 1,
        action: "idle",
        hasUnicorn: false,
        invincible: 0
      };
      
      window.boss = window.boss || {
        x: 600, y: 350,
        width: 120, height: 120,
        health: 5,
        maxHealth: 5,
        enraged: false,
        phase: 1,
        attackCooldown: 0,
        warningTimer: 0,
        fireballs: []
      };
      
      window.unicorn = window.unicorn || {
        active: false,
        power: 0,
        cooldown: 0
      };
      
      window.platforms = window.platforms || [];
      window.friends = window.friends || [];
      window.enemies = window.enemies || [];
      window.items = window.items || [];
      window.hearts = window.hearts || [];
      window.projectiles = window.projectiles || [];
      window.particles = window.particles || [];
      window.keys = window.keys || {};
      
      // Definir niveles si no existen
      window.LEVELS = window.LEVELS || {
        "1-1": { name: "Bosque Inicial", friends: 3, enemies: 2, items: 2, hasBoss: false },
        "1-2": { name: "Claro Soleado", friends: 4, enemies: 3, items: 3, hasBoss: false },
        "1-3": { name: "Cueva Misteriosa", friends: 5, enemies: 4, items: 4, hasBoss: false },
        "2-1": { name: "Monta√±as Altas", friends: 4, enemies: 5, items: 3, hasBoss: false },
        "2-2": { name: "Cascada Brillante", friends: 5, enemies: 5, items: 4, hasBoss: false },
        "2-3": { name: "Guarida del Lobo", friends: 0, enemies: 0, items: 0, hasBoss: true }
      };
      
      // Obtener referencias a elementos del DOM
      const gameCanvas = document.getElementById('gameCanvas');
      const startScreen = document.getElementById('startScreen');
      const startButton = document.getElementById('startButton');
      const victoryScreen = document.getElementById('victoryScreen');
      const nextLevelBtn = document.getElementById('nextLevelBtn');
      const storybook = document.getElementById('storybook');
      const startGameBtn = document.getElementById('startGame');
      const soundToggle = document.getElementById('soundToggle');
      const hintElement = document.getElementById('hint');
      
      // Configurar canvas
      if (gameCanvas) {
        window.gameCtx = gameCanvas.getContext('2d');
      }
      
      // Configurar botones
      if (startButton) {
        startButton.addEventListener('click', showStorybook);
      }
      
      if (startGameBtn) {
        startGameBtn.addEventListener('click', startGame);
      }
      
      if (nextLevelBtn) {
        nextLevelBtn.addEventListener('click', nextLevel);
      }
      
      if (soundToggle) {
        soundToggle.addEventListener('click', toggleSound);
      }
      
      // Configurar controles t√°ctiles
      const leftBtn = document.getElementById('leftBtn');
      const rightBtn = document.getElementById('rightBtn');
      const jumpBtn = document.getElementById('jumpBtn');
      const hugBtn = document.getElementById('hugBtn');
      const fireBtn = document.getElementById('fireBtn');
      
      if (leftBtn) leftBtn.addEventListener('touchstart', () => window.keys["ArrowLeft"] = true);
      if (leftBtn) leftBtn.addEventListener('touchend', () => window.keys["ArrowLeft"] = false);
      
      if (rightBtn) rightBtn.addEventListener('touchstart', () => window.keys["ArrowRight"] = true);
      if (rightBtn) rightBtn.addEventListener('touchend', () => window.keys["ArrowRight"] = false);
      
      if (jumpBtn) jumpBtn.addEventListener('touchstart', () => {
        window.keys["ArrowUp"] = true;
        setTimeout(() => { window.keys["ArrowUp"] = false; }, 200);
      });
      
      if (hugBtn) hugBtn.addEventListener('touchstart', () => {
        window.keys[" "] = true;
        setTimeout(() => { window.keys[" "] = false; }, 200);
      });
      
      if (fireBtn) fireBtn.addEventListener('touchstart', () => {
        window.keys["z"] = true;
        setTimeout(() => { window.keys["z"] = false; }, 200);
      });
      
      // Configurar controles de teclado
      document.addEventListener('keydown', (e) => {
        window.keys[e.key] = true;
      });
      
      document.addEventListener('keyup', (e) => {
        window.keys[e.key] = false;
      });
      
      // Iniciar bucle del juego
      setInterval(() => {
        if (window.gameState.gameStarted) {
          window.update();
          window.draw();
        }
      }, 1000/60);
      
      console.log("‚úÖ Juego inicializado correctamente");
    });
    
    // Funciones auxiliares
    function showStorybook() {
      const startScreen = document.getElementById('startScreen');
      const storybook = document.getElementById('storybook');
      
      if (startScreen) startScreen.style.display = 'none';
      if (storybook) storybook.style.display = 'flex';
    }
    
    function startGame() {
      const storybook = document.getElementById('storybook');
      if (storybook) storybook.style.display = 'none';
      
      window.gameState.gameStarted = true;
      window.gameState.score = 0;
      window.gameState.lives = 3;
      window.gameState.heartsCollected = 0;
      
      // Configurar nivel inicial
      if (window.setupLevel) {
        window.setupLevel("1-1");
      }
      
      // Reproducir m√∫sica de fondo si est√° habilitado
      if (window.gameState.soundEnabled) {
        const introMusic = document.getElementById('introMusic');
        if (introMusic) {
          introMusic.volume = 0.7;
          introMusic.play().catch(e => console.log("Error reproduciendo m√∫sica:", e));
        }
      }
    }
    
    function nextLevel() {
      const victoryScreen = document.getElementById('victoryScreen');
      if (victoryScreen) victoryScreen.style.display = 'none';
      
      const nextLevelKey = window.getNextLevel ? window.getNextLevel(window.gameState.currentLevel) : "1-1";
      
      if (nextLevelKey && window.setupLevel) {
        window.setupLevel(nextLevelKey);
      } else {
        // Reiniciar juego si no hay m√°s niveles
        startGame();
      }
    }
    
    function toggleSound() {
      window.gameState.soundEnabled = !window.gameState.soundEnabled;
      const soundToggle = document.getElementById('soundToggle');
      
      if (soundToggle) {
        soundToggle.textContent = window.gameState.soundEnabled ? "üîä" : "üîá";
      }
      
      // Pausar o reanudar m√∫sica seg√∫n el estado
      const introMusic = document.getElementById('introMusic');
      const battleMusic = document.getElementById('battleMusic');
      
      if (window.gameState.soundEnabled) {
        if (introMusic && window.gameState.gameStarted && !window.gameState.bossFight) {
          introMusic.play().catch(e => console.log("Error reproduciendo m√∫sica:", e));
        }
        if (battleMusic && window.gameState.gameStarted && window.gameState.bossFight) {
          battleMusic.play().catch(e => console.log("Error reproduciendo m√∫sica:", e));
        }
      } else {
        if (introMusic) introMusic.pause();
        if (battleMusic) battleMusic.pause();
      }
    }
    
    // Funci√≥n para mostrar indicaciones
    function showHint(text, duration) {
      const hintElement = document.getElementById('hint');
      if (!hintElement) return;
      
      hintElement.textContent = text;
      hintElement.style.opacity = '1';
      
      setTimeout(() => {
        hintElement.style.opacity = '0';
      }, duration);
    }
  </script>
</body>
</html>
