<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Microdeleción 15q11.2 – Portal Colaborativo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Conoce la microdeleción 15q11.2 BP1-BP2 y colabora con datos clínicos para avanzar en la investigación.">
  
  <!-- Preload critical resources -->
  <link rel="preload" href="css/styles.css" as="style">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" as="font" crossorigin>
  
  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Favicon -->
  <link rel="icon" href="img/dna-icon.svg" type="image/svg+xml">
</head>

<body>
  <!-- [Todo el contenido del header, hero y main se mantiene igual hasta el footer] -->
  
  <footer>
    <div class="footer-content">
      <p>© 2025 – Investigación colaborativa sobre microdeleción 15q11.2</p>
      <div class="footer-links">
        <a href="privacy.html">Privacidad</a>
        <a href="ethics.html">Ética</a>
        <a href="contact.html">Contacto</a>
      </div>
    </div>
  </footer>

  <!-- Código corregido para cargar estadísticas -->
  <script type="module">
    // Solución CORS usando proxy
    const getExcelUrl = () => {
      const baseUrl = 'https://raw.githubusercontent.com/Evelez23/-microdelecion/main/listaPacientes.xlsx';
      return `https://api.allorigins.win/raw?url=${encodeURIComponent(baseUrl)}`;
    };

    async function loadStats() {
      try {
        // 1. Cargar datos con proxy CORS
        const response = await fetch(getExcelUrl());
        if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
        
        const data = await response.arrayBuffer();
        const { read, utils } = await import('https://cdn.sheetjs.com/xlsx-0.19.3/package/xlsx.mjs');
        const workbook = read(data);
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const pacientes = utils.sheet_to_json(firstSheet);

        // 2. Procesar estadísticas con manejo de errores
        const total = pacientes.length;
        const edades = pacientes.map(p => {
          const edad = parseFloat(p.Edad) || parseFloat(p.Edad?.match(/\d+/)?.[0]) || 0;
          return edad > 0 ? edad : null;
        }).filter(Boolean);

        const avgAge = edades.length ? (edades.reduce((a, b) => a + b, 0) / edades.length).toFixed(1) : 'N/A';
        const femaleCount = pacientes.filter(p => p['*GÃ©nero'] === 'F').length;
        const femalePercent = total > 0 ? Math.round((femaleCount / total) * 100) : 0;

        // 3. Actualizar UI
        document.getElementById('total-cases').textContent = total;
        document.getElementById('avg-age').textContent = avgAge;
        document.getElementById('female-percent').textContent = `${femalePercent}%`;

      } catch (error) {
        console.error('Error:', error);
        document.getElementById('stats-grid').innerHTML = `
          <div class="error">
            <p>Datos no disponibles temporalmente</p>
            <small>Intenta recargar la página más tarde</small>
          </div>
        `;
      }
    }

    // Cargar después de que la página esté lista
    if (document.readyState === 'complete') {
      loadStats();
    } else {
      document.addEventListener('DOMContentLoaded', loadStats);
    }
  </script>

  <!-- Estilos para mensajes de error -->
  <style>
    .error {
      background: #fff5f5;
      color: #e53e3e;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      text-align: center;
    }
    .error small {
      opacity: 0.8;
      font-size: 0.9em;
    }
  </style>
</body>
</html>
